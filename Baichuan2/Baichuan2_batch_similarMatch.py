import torch,json,sys
from transformers import AutoModelForCausalLM, AutoTokenizer
from transformers.generation.utils import GenerationConfig

fewshot_num = int(sys.argv[1]) if sys.argv[1] else 0
tokenizer = AutoTokenizer.from_pretrained("./model_baichuan2_7B_chat",use_fast=False, trust_remote_code=True)
model = AutoModelForCausalLM.from_pretrained("./model_baichuan2_7B_chat", device_map="auto", torch_dtype=torch.bfloat16, trust_remote_code=True)
model.generation_config = GenerationConfig.from_pretrained("./model_baichuan2_7B_chat")

filename = '../LLMData/按任务打包/相似案例匹配/valid.json'
count=num=right=dlen=0
with open(filename, 'r', encoding='utf-8') as file:
    for line in file:
        json_line = json.loads(line.strip())
        count += 1
        label = json_line['label']
        text_a = json_line['A']
        text_b = json_line['B']
        text_c = json_line['C']
        example1 = '原告：高洪玉，男，1985年9月24日生，汉族，农民，住迁西县。被告：李宝红，男，1987年7月17日生，汉族，农民，住迁西县。\n\n原告高洪玉诉称：2011年1月22日，被告李宝红向原告借款5万元，约定一个月 内还清并为原告出具借据一张。被告未按期还款，被告于2013年4月22日又向原告借款5万元，依然约定一个月内还清并出具了借据一张。被告累计向原告借款10万元整，虽经原告多次催要，被告至今未予归还，故诉至法院，要求被告偿还借款100000元及利息。原告高洪玉为证明自己主张，提交如下证据：借据两张。其一内容为：“今借到高红玉（身份证号）人民币现金伍万元整，小写50000元，双方经友好协商，自借款之日起一个月内一次性还清，特此立字为据。借款人：李宝红，（身份证号，2011年1月22日”。其二内容为：“今借到高洪玉（身份证号）人民币现金伍万元整，小写50000元，双方经友好协商，自借款之日起一个月内一次性还清，特此立字为据。借款人：李宝红，（身份证号，2013年4月22日”。证明被告李宝红两次向原告借款合计100000元未予返还的事实。被告李宝红未提交书面答辩及证据，亦未参加本院庭审。被告李宝红经公告本院传票传唤，无正当理由拒不到庭参加诉讼，视为其放弃当庭享有的诉讼权利，并承担举证不能的法律后果。原告高洪玉提供的证据具有客观真实性、合法性和关联性，确认为有效证据，具有证明力，予以采信。能够认定被告李宝红向原告借款100000元未予返还的事实。并作为本院审理查明认定的事实。B：原告：黄健，男，1971年10月11日出生，汉族。被告：申长富，男，1964年1月6日出生，汉族。委托诉讼代理人：张杰，四川沱江律师事务所律师。\n\n原告黄健向本院提出诉讼请求：1、判令被告申长富偿还借款本金500000元及利息，利息从2017年5月31日起，按月2％计算；2、本案诉讼费及诉前保全费由被 告承担。事实和理由：被告申长富因资金周转困难，于2007年10月17日出具借条一张，借到原告现金人民币500000元，至今未还。被告申长富辩称，对借条本身的真实性无异议，但不能证明原告支付现金的事实，应驳回原告的诉讼请求。借条上未约定利息，原告要求给付起诉前的利息请求不应支持，起诉后的利息应当按照银行发布的同期同类贷款利率计算。本院经审理认定事实如下：2007年10月17日，被告申长富因资金周转困难向原告黄健借款，原告黄健在刘文斌、林瑞金陪同下将现金人民币500000元送到内江飘香园饭店借给被告后，被告申长富向原告出具内容为“今借到黄健人民币现金伍拾万元整，小写500000.00，借款人申长富”借条一张。被告借款后至今未还。另查明，本院根据原告黄健的诉前财产保全申请，于2017年6月1日作出（2017）川1011财保72号民事裁定书，对被告申长 富在银行的存款限额冻结600000元，实际控制金额31370.05元，另轮候查封了被告申长富名下位于内江市市中区劳动村13幢47号的房屋（产权证号0081929）。 上述事实，有原告提供的借条、证人证词及诉前保全材料、庭审笔录等在案为凭，予以证实。C：原告李某某，住河南省开封市。被告王某某，住河南省长垣县。委托代理人吴新生 、周慧（实习），金研（郑州）律师事务所律师。\n\n原告诉称，被告于2015年2月29号向原告以资金周转为由借款本金贰拾万元整，约定利息月息2分利，约定2015年3月29号还款，但至今未还款。被告于2015年2月29号向原告以资金周转为由借款本金拾万元整，约定利息月息2分利，约定2015年3月29号还款，但至今没有还款。被告于2005年3月10日向原告以资金周转为由借款本金十万元整，约定利息月息2分利，约定2015年4月十日还款，但至今没有还款。故诉至法院请求依 法判令：被告偿还原告本金40万元整，被告支付原告利息16万元（利息按照月利率2％支付原告自2015年3月10日至2017年4月17日），本案诉讼费用由被告承担 。被告王某某辩称，借条的真实性无异议，本金是真实存在的，但借条上没有约定利息，没有约定利息不应当支持，钱不是不还，是把钱借给赵某某了，已经起诉了，金水法院已经受理的，在民二庭。经审理查明：原告提交的《借条》三份，内容主要记载为：1、今借李某某现金贰拾万元整，2015年2月29号到2015年3 月29号止，借款人王某某，2015年2月29号；2、今借李某某现金拾万元整，用期一个月，从2015年2月29号到2015年3月29号，借款人王某某，2015年2月29号；3、今借李某某现金拾万元整，2015年3月10日至2015年4月10日止，用期一个月，借款人王某某，2015年3月10日。'
        example1_a = 'C'
        example2 = '原告：李学章，个体户。委托诉讼代理人：胡元伟，邳州胜阳法律服务所法律工作者。被告：朱洪付，农民。被告：刘海永，农民。被告：张飞，农民。\n\n原告李学章向本院提出诉讼请求：1．请求依法判令被告偿还原告借款本金20000元及利息（以20000元为本金，按照月利率2％，从2011年2月6日起计算至实 际给付之日止）。2．被告承担本案诉讼费用。事实与理由：2011年2月16日，被告朱洪付向原告借款20000元，约定借款期限二个月，月息2.6％并书写了借条，被告刘海永、张飞提供担保。借款到期后经原告多次催要，但三被告一直拒不偿还。为维护原告合法权益，特提起诉讼，要求支持原告的诉讼请求。被告朱洪付、刘海永、张飞未答辩。当事人围绕诉讼请求依法提交了证据，本院组织当事人证据交换和质证。因被告朱洪付、刘海永、张飞未到庭参加诉讼，视为放弃质证的权利，对于借条及证人证言的真实性、关某、合法性本院予以确认并在卷佐证。本院认定的事实如下：2011年2月16日，被告朱洪付向原告借款20000元并向原告李学章出具借据一份，载明被告朱洪付向原告李学章借款20000元，月利息2.6％，借款期限二个月，定于2011年4月16日前归还并约定违约金。被告刘海永、 张飞提供担保至还款之日止。担保的期限为贰年。借款到期后，被告朱洪付及被告刘海永、张飞均未依约还款，原告李学章遂提起诉讼，要求判如所请。庭审中，原告自愿将利息调整为月息2％并自认预扣利息1040元。另查明，依据证人胡某的证言，证明原告向被告刘海永、张飞主张过权利。B：原告赵秀山，男，汉族，个体，住乌海市海勃湾区。被告刘孝娟，女，汉族，住乌海市海勃湾区。被告郗新文，男，汉族，住址同上（与被告刘孝娟系 夫妻关系）。被告伊占芬，女，汉族，住乌海市海勃湾区。\n\n原告赵秀山诉称，2010年1月25日、2011年1月10日，三被告向原告借款100000元，约定月息3分 ，借款后付息至2012年8月30日，后被告并未按时偿还本金及利息，故向人民法院提起诉讼，请求依法判令：1、被告偿还借款100000元，支付至2016年4月30日 的利息88000元；2、被告支付利息至借款清偿止，并承担本案诉讼费。被告郗新文辨称，借款属实，借款人实际是我与刘孝娟，伊占芬是担保人。被告刘孝娟、伊占芬未到庭，亦未提供书面答辩意见。经审理查明，2010年1月25日，被告刘孝娟、郗新文向原告赵秀山借款50000元，并向原告出具借条一张，载明：“今借 到赵秀山伍万元整（50000元），月付利息每月1千五百元整，月利息3分”，借款人处有被告刘孝娟、郗新文及担保人伊占芬的签名。2011年1月10日，被告刘孝 娟、郗新文、伊占芬又向原告赵秀山借款50000元，并于同日向原告出具借条一张，载明：“今借到赵秀山现金伍万元整（50000元），月利息3分，月计1500元，月付利息”，借款人处有被告刘孝娟、伊占芬、郗新文的签名。借款后被告付息至2012年8月30日，借款本息原告多次催要，被告至今未支付。另查明，被告刘孝娟、郗新文于上述借款期限系夫妻关系。上述事实有原、被告的陈述，原告提交的被告刘孝娟、郗新文、伊占芬所立借条两张予以证实，本院予以采信。C：原告：赵明明，男，汉族。委托诉讼代理人：吴燕平，女，汉族。被告：马浩铜，男，汉族。被告：张恩赐，男，汉族。\n\n原告赵明明向本院提出诉讼请求：1、二被告连带偿还借款105000元；2、二被告按月2％支付2017年1月15日至判决日利息；3、案件受理费由被告承担。事实及理由：2016年3月15日，被告马浩铜向其借款90000元，约定每月支付利息2000元，借期至2017年1月15日。被告马浩铜出具了110000元的借条，张恩赐为该笔借款提供连带担保。借款到期后，被告马浩铜于2017年1月27日仅仅偿还了5000元，余款以无钱为由拖延至今。被告马浩铜未到庭应诉，但在庭审中，通过电话向法庭陈述了如下事实：2016年3月15日其向原告借款90000元属实，借期10个月，其向原告出具了本息110000元的借条。张恩赐为借款提供连带担保。被告张恩赐辩称：原告陈述事实属实。被告马 浩铜有能力偿还借款，应由马浩铜本人承担偿还责任。庭审中原告赵明明提供借条一份，经被告质证无异议。该证据能够证明被告马浩铜借原告90000元并由被 告张恩赐提供担保的事实，本院对其证明目的予以确认。本院经审理认定事实如下：2016年3月15日，被告马浩铜向原告赵明明借款90000元，借期2016年3月15 日至2017年1月15日，每月支付利息2000元，被告马浩铜向原告赵明明出具了（本息）110000元的借条，被告张恩赐提供连带担保。后被告马浩铜于2017年1月27日偿还原告利息5000元。'
        example2_a = 'B'
        example3 = '原告刘金福（ 身份证号码352624197309021617），男，1973年9月2日出生，汉族，农民，住上杭县。委托代理人蓝立仁（身份证号码352624194508161619），男，1945年8月16日出生，畲族，住上杭县。被告蓝永隆（身份证号码350823198903281611），男，1989年3月28日出生，畲族，农民，住上杭县。\n\n原告刘金福诉称，2014年7月11日，被告蓝永隆以急需资金救急为由向原告刘金福借款2万元，借期3个月，被告蓝永隆向原告刘金福立下借条一张。借条还约定，若被告蓝永隆未按时还 款，则每月按借款本金的20％支付违约金，并承担因导致诉讼而产生的律师费、诉讼费、误工费等。借款后，被告蓝永隆未还款。为此，原告刘金福依法提起诉讼，请求法院判令被告蓝永隆偿还原告刘金福借款本金2万元，并按借条约定支付误工费等每日费用1000元及按银行利率计算的利息。被告蓝永隆经本院送达起 诉状副本、应诉通知书、举证通知书、诉讼风险提示书、开庭传票等法律文书，未向本院提交答辩状及证据。原告刘金福为证明其主张向本院提供借条一张，证明借款的事实。被告蓝永隆未到庭参加诉讼，视为放弃对上述证据进行质证的权利。经审查认为，原告刘金福提供的上述证据真实、合法，与本案相关联，可以作为认定本案事实的依据，本院予以认定。根据上述认定的有效证据，结合当事人的陈述，本院对本案事实认定如下：2014年7月11日，被告蓝永隆以急需资金 救急为由向原告刘金福借款2万元，借期3个月，被告蓝永隆向原告刘金福立下借条一张。借条还约定，若被告蓝永隆未按时还款，则每月按借款本金的20％支付违约金，并承担因导致诉讼而产生的律师费、诉讼费、误工费等。借款后，被告蓝永隆未还款。2016年8月24日，原告刘金福诉至本院。B："原告：邹学兰，女，1967年5月2日出生，汉族，个体劳动者，住呼图壁县。委托诉讼代理人：陈新红，新疆资本律师事务所律师。被告：刘萍萍，女，1991年11月21日出生，汉族，个体劳动者，住呼图壁县。被告：胡耀光，男，1990年10月1日出生，汉族，个体劳动者，住呼图壁县。\n\n原告邹学兰向本院提出诉讼请求：一、判决被告刘萍萍偿还原告邹学兰借款370000元；二、判令被告胡耀光对上述款项承担连带清偿责任；三、保全费2370元由二名被告承担。事实与理由：2015年6月4日、2015年6月12日，原告分两次向被告刘萍萍的银行卡内转入110000元、260000元。被告刘萍萍收到上述款项后未向原告出具借条，经原告 多次要求，被告将其父母书写的借条出具给原告，被告刘萍萍未在借条上签字。二名被告系夫妻关系。后被告刘萍萍以种种理由未向原告偿还借款。被告刘萍萍、被告胡耀光辩称，1、原、被告不存在借贷关系，二名被告也未向原告借过任何款项，被告主体不适格。2、本案中的借款虽汇入被告刘萍萍的银行账户，但该款项系被告刘萍萍的母亲李振洽向原告所借，因李振洽不会操作银行转账事宜、没有农村信用社的银行卡，所以李振洽让原告把款项汇入被告刘萍萍的账户。3 、目前二名被告已经离婚。本院经审理认定事实如下：对于当事人双方没有争议的事实，本院予以确认。对双方当事人有争议的事实，本院认定如下：原告为证明被告向其借款370000元的事实，提交银行流水2张、呼图壁县农村信用合作联社客户回单2张，经质证，二名被告对该组证据的真实性认可，提出该笔借款系被告刘萍萍的母亲所借，被告刘萍萍并未向原告借款。因二名被告对该该组证据的真实性无异议，本院对该组证据的真实性予以确认。C：原告：程某某，男，1962年7月8日出生，汉族，住安徽省寿县。委托诉讼代理人：李多才，男，1944年10月10日出生，汉族，住安徽省淮南市谢家集区。被告：李某某，女，1977年5月13日出生，汉族，住安徽省淮南市谢家集区。\n\n程某某向本院提出诉讼请求：1、要求判决李某某返还程某某借款120000元整；2 、李某某承担本案诉讼费。事实和理由：程某某与李某某居住不远。2013年4月6日，李某某向程某某借款100000元，李某某出具有借条；2014年6月7日，李某某向程某某借款20000元，李某某未出具借条。后程某某向李某某多次讨要借款，但李某某一直未偿还，故程某某诉至法院，要求判如所请。基于上述诉请，程某 某提供下列证据：1、身份证复印件一份，意在证明程某某的身份情况；2、借条原件一份，意在证明李某某于2013年4月6日向程某某借款100000元的事实。李某某未提交书面答辩，亦未在举证期限内提交相关证据。经庭审举证、审查，本院对涉案证据认证意见如下：李某某未到庭发表质证意见，视为放弃了质证权利。本院对程某某所举证据的真实性、合法性及与本案的关联性予以认定。根据上述认定的证据材料及庭审中当事人的陈述，审理查明的事实为：程某某与李某某原本相识。李某某因做生意需要资金向程某某借款，程某某借款后，李某某于2013年4月6日亲笔书写借条一张。双方未约定利息，也未约定还款期限。后程某某向李某某催要还款，但李某某一直没有偿还，故程某某起诉来院，要求判如所请。庭审中，程某某当庭将诉讼请求由要求李某某返还程某某借款120000元整变更为要求李某某返还程某某借款100000元整。'
        example3_a = 'C'
        example4 = '原告：邓先和，男，1969年4月6日生，汉族，住安徽省旌德县。委托代理人：龙金火，旌德县旌阳镇法律服务所法律工作者。被告：刘先权，男 ，1970年11月14日生，汉族，住安徽省宣城市。\n\n原告邓先和诉称：2014年12月4日，被告向原告借款300000元作为资金周转，承诺三个月归还本金及利息（ 月利率2％），并出具书面借条。被告至今未归还借款本金及利息。现请求判令被告立即偿还本金300000元和利息，利息自2014年12月4日起至归还之日止，按月利率2％计算，并承担本案受理费。被告刘先权未向本院递交答辩材料。原告邓先和为证明自己的主张，向本院递交的证据及本院的认证意见：1、居民身份证复印件1份，证明原告具备本案的诉讼主体资格。2、借条1份，证明被告刘先权于2014年12月4日向原告借款300000元，并约定借款期限为六个月，归还日期为2015年5月4日。被告拒不到庭，视为放弃抗辩和质证的权利。经本院审查，原告邓先和所举证据均符合证据的关联性、真实性和合法性，予以认定。根据对上述证据的认定并结合当事人的陈述，本院认定本案的法律事实为：2014年12月4日，被告刘先权向原告邓先和出具借条1份，写明其因急需资金周转向原告邓先和借款300000元，期限六个月，还款日期为2015年5月4日，愿意以祥云子午圲的2014年-2015年砍伐树木作抵押。2016年2月19日，原告邓先和具状本院。庭审中，原告明确要求判令被告立即归还本金300000元，并自2014年12月4日起至还款之日止，按月利率2％计算利息；本案诉讼费由被告承担。B：原告：尹江潮，男，1978年10月7日出生，汉族，住献县。被告：陈铁庆，男，1982年11月25日出生，汉族，住献县。追加被告：李士恋，女，1981年8 月1日出生，汉族，住献县。\n\n尹江潮向本院提出诉讼请求：1．判令被告偿还原告借款及利息共计12万元；2．本案诉讼费由被告承担。事实和理由：原、被 告系朋友关系，2015年7月初，被告陈铁庆以资金周转为由，向原告提出借款10万元，并口头承诺给付利息。原告出于对朋友的信任，将存有十万元的银行卡交 由陈铁庆自行支取。后经原告催要本金及利息，被告陈铁庆于2016年7月19日给原告出具一份金额为12万元的借条，但该款被告陈铁庆至今未给付。故此，原告 诉至法院陈铁庆辩称，对于所借原告12万元本息的事实无异议，但该债务是我与李士恋共同做生意所欠下的债务，属于我二人的夫妻共同债务，故应由我二人共同偿还。另外，李士恋已将借条上所抵押给原告的车辆私自过户到其父亲名下。李士恋在法定期限内未向本院提交答辩状及证据。经审理本院认定事实如下，2015年7月3日，被告陈铁庆及追加被告李士恋由于做生意需要资金，向原告借款100000元，并口头承诺给付利息，但此后二被告并未偿还借款本息。后经原告催要，被告陈铁庆就100000元借款本金及20000元利息于2016年7月19日给原告出具一份借条，内容为：今借尹江潮壹拾贰万元整，本人愿以本人车辆作为抵押，车号为636FW，借款人陈铁庆，2016.7.19。但至今二被告并未向原告偿还该借款。以上事实有原、被告陈述及原告提交的《借条》、银行卡取款明细等证据可供认定。C：原 告：金国昌，男，1969年11月6日出生，汉族，住诸暨市。委托诉讼代理人：马悦铨，浙江越兴律师事务所律师。委托诉讼代理人：许建霞，浙江越兴律师事务 所律师。被告：祝贤根，男，1963年3月31日出生，汉族，住诸暨市。被告：祝小芳，女，1965年1月22日出生，汉族，住诸暨市。被告：诸暨市精灵新型轻质材料厂，住所地：诸暨市王家井镇祝家村。投资人：祝贤根。\n\n原告金国昌向本院起诉要求：1、判令被告祝贤根、祝小芳归还原告借款本金40万元，并支付自2017年7月18日起至款还清之日止按月利率1.5％计算的利息；2、判令被告诸暨市精灵轻型轻质材料厂在其位于诸暨市王家井整祝家村的土地和厂房（地号：23-100-0-86，土地使用权面积为300平方米）范围内对上述债务承担连带清偿责任；三，本案诉讼费由三被告承担。事实与理由：被告祝贤根、祝小芳系夫妻。两被告因生产经营所需多次向原告借款，至2017年1月18日共计借款人民币40万元，由被告祝贤根、祝小芳出具借条一份，约定借款月利率为1.5％。被告诸暨市精灵新型轻质材料厂自愿以其坐落于诸暨市王家井镇祝家村的300平方米的土地使用权和厂房（地号：23-100-0-86）为上述借款提供抵押担保。2018年2月13日，被 告祝贤根、祝小芳支付利息36000元后，剩余借款本息至今未还。现原告为维护自身合法权益特诉至法院，望判如所请。被告祝贤根、祝小芳未作答辩，也未提 交抗辩证据。原告金国昌围绕诉请向本院提供结借条、土地使用证书等证据材料。上述证据材料经庭审出示，被告均未到庭参加诉讼，视为自愿放弃对原告所提供的证据材料进行质证和辩解的权利。本院经审核认为，上述证据材料系原件一致，且原告能保证其真实性，故本院作为有效证据认定。综上，本院经审理认定的事实与原告的诉请事实相一致。'
        example4_a = 'B'
        instruct = "下面B、C两个句子哪个和给定文本更相似，如果B更相似返回B否则返回C，不需要重复原文内容，只返回答案部分即可。"
        s = text_a + "。B：" + text_b + "。C：" + text_c
        messages = []
        messages.append({"role": "system", "content": instruct})
        if fewshot_num >= 1:
            messages.append({"role": "user", "content": example1})
            messages.append({"role": "assistant", "content": example1_a})
        if fewshot_num >= 2:
            messages.append({"role": "user", "content": example2})
            messages.append({"role": "assistant", "content": example2_a})
        if fewshot_num >= 3:
            messages.append({"role": "user", "content": example3})
            messages.append({"role": "assistant", "content": example3_a})
        if fewshot_num >= 4:
            messages.append({"role": "user", "content": example4})
            messages.append({"role": "assistant", "content": example4_a})
        messages.append({"role": "user", "content": s})
        response = model.chat(tokenizer, messages)
        if label in response:
            right+=1
        if 'B' in response and 'C' in response:
            right -= 1
        if count % 100 == 0:
            print(count, label, '=============', response)
            print(count, right, float(right / count))
print(count,right,float(right/count))